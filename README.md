# Go番茄钟计时器
this branch(feat/web) is just for me to study backend and frontend

一个功能丰富的命令行番茄钟计时器，使用 Go 语言编写。

## 目录结构

```
common/   # 终端颜色与通用输出
config/   # 配置结构体与默认配置
menu.go   # 主菜单与交互逻辑
main.go   # 程序入口
util/     # 应用主逻辑、命令处理、快捷键、统计等
timer/    # 番茄钟计时器核心、任务存储与计时逻辑
task/     # 任务管理（增删查改、持久化）
```

## 功能特点

- 可自定义工作和休息时间
- 多种计时器显示方式（普通显示、ANSI字符艺术显示）
- 设置菜单功能（时间显示格式、查看/重置设置）
- 任务管理（添加、完成、删除、清空、最近任务）
- 统计功能（工作/休息会话数、总工作时长、任务完成率）
- 实时显示剩余时间
- 支持优雅退出（Ctrl+C）
- 任务数据自动保存和加载
- 跨平台支持（根据操作系统自动选择清屏方式）

## 安装与运行

1. 确保已安装 Go 1.21 或更高版本
2. 克隆此仓库
3. 运行程序：

```bash
# 基本运行
go run main.go

# 使用命令行参数
go run main.go --name "我的任务"  # 设置任务名称
```

## 命令行参数

- `--name` - 设置任务名称（默认：默认任务）

## 菜单操作

- 添加新任务
- 查看所有任务
- 查看最近任务
- 开始专注任务（可自定义本次工作/休息时间）
- 标记任务完成
- 删除任务
- 清空所有任务
- 设置（时间显示格式、查看当前设置、重置为默认设置）
- 退出

## 交互命令（计时界面下）

- `help`      - 显示帮助信息
- `stats`     - 显示统计信息
- `tasks`     - 显示任务列表
- `add <描述>` - 添加新任务
- `complete <ID>` - 完成任务
- `work <时间>`   - 设置工作时间（如：25m）
- `break <时间>`  - 设置休息时间（如：5m）
- `name <名称>`   - 设置当前任务名称
- `pause`     - 暂停计时
- `resume`    - 恢复计时
- `start`     - 手动开始计时（非自动模式）
- `quit`      - 退出计时

### 快捷键

- `g` - 开始计时
- `p` - 暂停
- `r` - 恢复
- `s` - 统计
- `t` - 任务
- `h` - 帮助
- `q` - 退出

### 时间格式示例

- `25m` - 25分钟
- `1h`  - 1小时
- `30s` - 30秒

## 计时器显示

支持两种计时器显示方式：

1. **普通显示** - 传统的数字时间显示
2. **ANSI字符艺术显示** - 使用ANSI字符艺术效果显示时间

可通过设置菜单切换显示方式。

## 设置功能

- **时间显示格式** - 选择计时器的显示方式
- **查看当前设置** - 显示所有当前配置
- **重置为默认设置** - 恢复所有设置为默认值

## 统计信息

- 工作会话数
- 休息会话数
- 总工作时间
- 任务完成率

## 任务管理

- 可添加多个任务
- 标记任务完成状态
- 查看任务列表和状态
- 任务数据自动保存到 `~/.gomato/tasks.json`
- 程序启动时自动加载已保存的任务

## 数据存储

- 任务数据保存在用户主目录下的 `.gomato` 文件夹中
- 任务数据文件：`~/.gomato/tasks.json`
- 单个任务配置：`~/.gomato/task.json`
- 数据会在以下情况下自动保存：
  - 添加新任务时
  - 完成任务时
  - 修改任务状态时

## 开发与测试

- 主要代码分布在 `main.go`, `menu.go`, `util/`, `timer/`, `task/`, `config/`, `common/` 等目录
- 单元测试位于 `util/util_test.go`, `timer/timer_test.go` 等
- 运行全部测试：

```bash
go test ./...
```

## 最近更新

- ✨ 新增ANSI字符艺术计时器显示功能
- ⚙️ 添加设置菜单，支持时间显示格式配置
- 🔧 重构配置管理，优化代码结构
- 🐛 修复暂停时计时器未真正暂停的bug
- 🌍 根据运行时检测操作系统进行清屏操作

## 常见问题

- 仅支持类Unix终端（如Linux/macOS）
- 确保终端支持ANSI转义序列以获得最佳显示效果

## Web应用（Gin + WebSocket）

这个分支（`feat/web`）将原有的命令行番茄钟应用改造成了一个Web应用。

### 技术栈

- **后端**: Go, [Gin](https://github.com/gin-gonic/gin) (用于HTTP服务和API), [Gorilla WebSocket](https://github.com/gorilla/websocket) (用于实时通信)
- **前端**: 原生 HTML, CSS, JavaScript (无框架)

### Web部分目录结构

```
web/
├── main.go         # Web服务器入口，包含所有后端逻辑
├── static/
│   ├── app.js      # 前端JavaScript，处理用户交互和与后端的通信
│   └── style.css   # 前端样式文件
└── templates/
    └── index.html  # 应用主页的HTML模板
```

### 如何运行Web应用

1.  确保你处于项目根目录。
2.  运行以下命令启动Web服务器：
    ```bash
    go run web/main.go
    ```
3.  在你的浏览器中打开 `http://localhost:8080`。

### API接口文档

Web应用通过一套RESTful API和一个WebSocket接口与前端进行通信。

#### 任务管理 API

| 方法  | 路径             | 描述                 | 请求体示例                 | 成功响应 (JSON)                               |
| :---- | :--------------- | :------------------- | :------------------------- | :-------------------------------------------- |
| `GET` | `/api/tasks`     | 获取所有任务列表     | (无)                       | `[{"id": 1, "description": "学习Go"}, ...]` |
| `POST`| `/api/tasks`     | 添加一个新任务       | `{"description": "新任务"}` | `{"id": 2, "description": "新任务", ...}`    |

#### 实时计时器 (WebSocket)

-   **连接地址**: `ws://localhost:8080/ws`

-   **客户端 -> 服务器**: 客户端通过发送简单的文本指令来控制计时器。
    -   `start`: 开始或恢复计时。
    -   `pause`: 暂停计时。
    -   `reset`: 重置计时器到默认的25分钟，并暂停。

-   **服务器 -> 客户端**: 服务器会周期性地（每秒）向所有连接的客户端广播当前剩余时间。
    -   **消息格式**: Go的 `time.Duration` 字符串，例如 `24m59s`。前端JavaScript负责将其解析并格式化为 `MM:SS` 的形式显示。


## 贡献

欢迎提交PR或issue！

---

感谢使用本番茄钟计时器！ 